"use strict";(self.webpackChunkpuls=self.webpackChunkpuls||[]).push([[979],{4979:function(e,t,r){r.r(t),r.d(t,{default:function(){return N}});var o=r(311),l=r(1158),a=r(7467);const n=r.n(a)().create({baseURL:"http://127.0.0.1:3000/api",timeout:5e3});n.interceptors.request.use((e=>{let t=c("token");return e.headers["x-token"]=t,e}),(e=>(l.ElMessage.error("拦截器异常",e),Promise.reject(e)))),n.interceptors.response.use((e=>0===e.data.code?e.data.data:(l.ElMessage.error(e.data.msg),Promise.reject(e))),(e=>(l.ElMessage.error("请求异常",e),Promise.reject(e))));const i=e=>{let{url:t,params:r,data:o,loading:l=!0}=e;return n({url:t,method:o?"post":"get",params:r,data:o})};let c=e=>{if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!==t){t=t+e.length+1;var r=document.cookie.indexOf(";",t);return-1===r&&(r=document.cookie.length),unescape(document.cookie.substring(t,r))}}return localStorage.getItem(e)};const s=e=>i({url:"Openlog",params:e});function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const f={class:"box-main"},m={class:"f-",style:{margin:"5px 0px"}},g={class:"gva-table-box"},w={class:"mt20"},h=(e=>((0,o.pushScopeId)("data-v-ed40e35a"),e=e(),(0,o.popScopeId)(),e))((()=>(0,o.createElementVNode)("div",{class:"gva-pagination"},null,-1))),v={class:"dialog-footer"},y={key:0,class:"f1",style:{"justify-content":"space-between"}},x={class:"mt20"};var V={__name:"index",setup(e){let t=(0,o.ref)(),r=(0,o.ref)(!1),a=(0,o.ref)(),n=(0,o.ref)({}),c=((0,o.ref)([]),(0,o.ref)([])),d=(0,o.ref)(""),p=(0,o.ref)("");function V(){let e=t.value.getSelectionRows().map((e=>e.Uid));var o;(o={list:e,name:n.value.region},i({url:"start",data:o})).then((e=>{})),r.value=!1,l.ElMessage.success("启动成功")}function N(){let e=t.value.getSelectionRows().map((e=>e.Uid));var r;(r={list:e,name:n.value.region},i({url:"stop",data:r})).then((e=>{})),l.ElMessage.success("脚本已停止")}function C(){let e=[];return c.value.forEach((t=>{let r=t.Group;e.push(r)})),[...new Set([...e])].map((e=>({text:e+"组",value:e})))}(0,o.onMounted)((async()=>{let{list:e,id:r,authorized:l}=await i({url:"DeviceList",params:a});var a;c.value=e.map((e=>u(u({},e),{},{Group:e.Group?e.Group:"X",Identifier:e.Identifier?e.Identifier:"X"}))),d.value=r,p.value=l,await(0,o.nextTick)(),t.value.sort("Group","ascending")}));const b=(e,r,o)=>{const l=o.property;return t.value.clearSelection(),r[l]===e};return(e,i)=>{const u=(0,o.resolveComponent)("el-table-column"),k=(0,o.resolveComponent)("el-tag"),S=(0,o.resolveComponent)("el-button"),E=(0,o.resolveComponent)("el-table"),_=(0,o.resolveComponent)("el-option"),O=(0,o.resolveComponent)("el-select"),j=(0,o.resolveComponent)("el-form-item"),D=(0,o.resolveComponent)("el-text"),T=(0,o.resolveComponent)("el-form"),U=(0,o.resolveComponent)("el-dialog"),P=(0,o.resolveComponent)("el-image"),I=(0,o.resolveComponent)("el-timeline-item"),R=(0,o.resolveComponent)("el-timeline");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)("div",f,[(0,o.createElementVNode)("div",m,[(0,o.createElementVNode)("span",null,"授权数量："+(0,o.toDisplayString)((0,o.unref)(p)),1),(0,o.createElementVNode)("span",null,"设备码："+(0,o.toDisplayString)((0,o.unref)(d)),1)]),(0,o.createElementVNode)("div",g,[(0,o.createVNode)(E,{ref_key:"Table",ref:t,style:{width:"100%"},"max-height":700,"tooltip-effect":"dark",data:(0,o.unref)(c),"row-class-name":e=>{let{row:t,rowIndex:r}=e;return t.State?"warning-row":"success-row"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{type:"selection"}),(0,o.createVNode)(u,{align:"center",label:"组/编号",property:"Group",filters:C(),width:"100","filter-method":b,"filter-multiple":!1},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.Group)+"/"+(0,o.toDisplayString)(e.row.Identifier),1)])),_:1},8,["filters"]),(0,o.createVNode)(u,{label:"连接状态",property:"Errs","filter-multiple":!1,filters:[{text:"在线",value:!1},{text:"离线",value:!0}],width:"100","filter-method":b},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(k,{effect:"dark","disable-transitions":"",type:e.row.Errs?"danger":"success"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.Errs?"离线":"在线"),1)])),_:2},1032,["type"])])),_:1}),(0,o.createVNode)(u,{label:"工作状态",property:"State","filter-multiple":!1,filters:[{text:"空闲中",value:!1},{text:"工作中",value:!0}],width:"100","filter-method":b},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(k,{effect:"dark","disable-transitions":"",type:e.row.State?"danger":"success"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.State?"工作中":"空闲中"),1)])),_:2},1032,["type"])])),_:1}),(0,o.createVNode)(u,{label:"设备信息",align:"center","show-overflow-tooltip":!0},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("span",null," IP: "+(0,o.toDisplayString)(e.row.Ip),1),(0,o.createElementVNode)("span",null," UID: "+(0,o.toDisplayString)(e.row.Uid),1),(0,o.createElementVNode)("span",null," ("+(0,o.toDisplayString)(e.row.Width)+"*"+(0,o.toDisplayString)(e.row.Height)+")",1)])),_:1}),(0,o.createVNode)(u,{align:"center",label:"操作"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(S,{type:"primary",link:"",onClick:t=>(0,o.unref)(s)({Uid:e.row.Uid}).then((t=>(0,o.isRef)(a)?a.value={list:t,Uid:e.row.Uid}:a={list:t,Uid:e.row.Uid}))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("工作状态")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","row-class-name"]),(0,o.createElementVNode)("div",w,[(0,o.createVNode)(S,{type:"primary",onClick:i[0]||(i[0]=e=>(0,o.unref)(t).toggleAllSelection())},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("全选/取消")])),_:1}),(0,o.createVNode)(S,{type:"primary",onClick:i[1]||(i[1]=e=>((0,o.unref)(t).clearFilter(),(0,o.unref)(t).clearSelection()))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("重置筛选")])),_:1}),(0,o.createVNode)(S,{type:"primary",onClick:i[2]||(i[2]=e=>(0,o.unref)(t).getSelectionRows().length?(0,o.isRef)(r)?r.value=!0:r=!0:(0,o.unref)(l.ElMessage).error("请选择要操作的设备"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("启动脚本")])),_:1}),(0,o.createVNode)(S,{type:"danger",onClick:i[3]||(i[3]=e=>(0,o.unref)(t).getSelectionRows().length?N():(0,o.unref)(l.ElMessage).error("请选择要操作的设备"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("停止脚本")])),_:1})]),h])]),(0,o.createVNode)(U,{modelValue:(0,o.unref)(r),"onUpdate:modelValue":i[7]||(i[7]=e=>(0,o.isRef)(r)?r.value=e:r=e),title:"启动脚本",width:"20%",center:""},{footer:(0,o.withCtx)((()=>[(0,o.createElementVNode)("span",v,[(0,o.createVNode)(S,{onClick:i[5]||(i[5]=e=>(0,o.isRef)(r)?r.value=!1:r=!1),style:{width:"30%",height:"40px"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("关闭")])),_:1}),(0,o.createVNode)(S,{type:"primary",onClick:i[6]||(i[6]=e=>V()),disabled:!(0,o.unref)(n).region,style:{width:"30%",height:"40px"}},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("确认")])),_:1},8,["disabled"])])])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{"label-width":"100px",model:(0,o.unref)(n),style:{"max-width":"460px"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(j,{label:"选择脚本",required:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(O,{modelValue:(0,o.unref)(n).region,"onUpdate:modelValue":i[4]||(i[4]=e=>(0,o.unref)(n).region=e),placeholder:"点击选择"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{label:"Tiktok宝箱",value:"Tiktok"})])),_:1},8,["modelValue"])])),_:1}),(0,o.createVNode)(j,{label:"选中数量"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(D,{class:"mx-1",type:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)((0,o.unref)(t).getSelectionRows().length),1)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,o.createVNode)(U,{modelValue:(0,o.unref)(a),"onUpdate:modelValue":i[8]||(i[8]=e=>(0,o.isRef)(a)?a.value=e:a=e),title:"工作状态",width:"20%",center:""},{default:(0,o.withCtx)((()=>[(0,o.unref)(a)?((0,o.openBlock)(),(0,o.createElementBlock)("div",y,[(0,o.createVNode)(P,{style:{width:"50%"},src:"http://127.0.0.1:3000/api/img/".concat((0,o.unref)(a).Uid,".png?t=").concat(Math.random()),"zoom-rate":1.2,"preview-src-list":["http://127.0.0.1:3000/api/img/".concat((0,o.unref)(a).Uid,".png?t=").concat(Math.random())],"initial-index":4,fit:"cover"},null,8,["src","zoom-rate","preview-src-list"])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",x,[(0,o.createVNode)(R,null,{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(a).list,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(I,{key:t,timestamp:e.time},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.content),1)])),_:2},1032,["timestamp"])))),128))])),_:1})])])),_:1},8,["modelValue"])],64)}}};var N=(0,r(89).Z)(V,[["__scopeId","data-v-ed40e35a"]])}}]);